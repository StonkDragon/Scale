import std.io

struct Foo
    function hello(): none
        "Hello, World!" puts
    end

    function msg(s: str): none
        s puts
    end
end

function main(args: Array): none
    # programmatically create a new instance of the struct Foo
    "Foo" Struct::getStructByName => decl s: Struct
    s:newInstance => decl f: Foo

    # call some methods on the struct
    f "hello" s:getMethodByName as lambda(Foo): none :accept
    f "Foo!" "msg" s:getMethodByName as lambda(Foo, str): none :accept

    # make sure trying to get non-existent structs throws an exception
    try
        "A" Struct::getStructByName
    catch typeof NullPointerException
        exception.msg puts
    done

    # make sure instantiating a static struct throws an exception
    try
        "FmtIO" Struct::getStructByName:newInstance
    catch typeof IllegalStateException
        exception.msg puts
    done

    # make sure the struct Struct is not instantiatable even with reflection
    try
        "Struct" Struct::getStructByName:newInstance
    catch typeof IllegalStateException
        exception.msg puts
    done
end
