VERSION: "23.7";

build: {
  compiler: "clang++";
  sourceDir: "Compiler";
  outputDir: "target";
  target: "sclc";
  includes: [
    "Compiler";
  ];
  units: [
    "Main.cpp";
    "modules/SyntaxTree.cpp";
    "modules/Parser.cpp";
    "modules/TokenHandlers.cpp";
    "modules/Tokenizer.cpp";
    "modules/Transpiler.cpp";
    "modules/DragonConfig.cpp";
    "modules/Function.cpp";
    "modules/InfoDumper.cpp";
    "Common.cpp";
  ];
  defines: [
    "VERSION=\"$(VERSION)\"";
    "C_VERSION=\"gnu17\"";
    "SCL_ROOT_DIR=\"/opt\"";
  ];
  std: "gnu++17";
  flags: [
    "-Wall";
    "-Wextra";
    "-Werror";
    "-pedantic";
  ];
  preBuild: [
    "git ls-files | egrep '(\.scale|\.c(pp)?|\.h(pp)?)$' | xargs wc -l > loc.txt";
    "sudo rm -rf /opt/Scale/$(VERSION)";
    "sudo mkdir -p /opt/Scale";
    "sudo cp -r Scale /opt/Scale/$(VERSION)";
    "sudo chmod -R 777 /opt/Scale";
  ];
  postBuild: [
    "sudo mv target/sclc /opt/Scale/$(VERSION)";
    "sudo rm -f /usr/local/bin/sclc";
    "sudo ln -s /opt/Scale/$(VERSION)/sclc /usr/local/bin/sclc";
    "rm -rf target";
    "python3 tests.py run";
  ];
};

install: {
  compiler: "clang++";
  sourceDir: "Compiler";
  outputDir: "target";
  target: "sclc";
  includes: [
    "Compiler";
  ];
  units: [
    "Main.cpp";
    "modules/SyntaxTree.cpp";
    "modules/Parser.cpp";
    "modules/TokenHandlers.cpp";
    "modules/Tokenizer.cpp";
    "modules/Transpiler.cpp";
    "modules/DragonConfig.cpp";
    "modules/Function.cpp";
    "modules/InfoDumper.cpp";
    "Common.cpp";
  ];
  defines: [
    "VERSION=\"$(VERSION)\"";
    "C_VERSION=\"gnu17\"";
    "SCL_ROOT_DIR=\"/opt\"";
  ];
  std: "gnu++17";
  flags: [
    "-Wall";
    "-Wextra";
    "-Werror";
    "-pedantic";
  ];
  preBuild: [
    "rm -rf /opt/Scale/$(VERSION)";
    "sudo mkdir -p /opt/Scale";
    "sudo chmod -R 777 /opt/Scale";
    "cp -r Scale /opt/Scale/$(VERSION)";
  ];
  postBuild: [
    "sudo mv target/sclc /opt/Scale/$(VERSION)";
    "sudo rm -f /usr/local/bin/sclc";
    "sudo ln -s /opt/Scale/$(VERSION)/sclc /usr/local/bin/sclc";
    "rm -rf target";
    "sh install_post.sh";
  ];
};
